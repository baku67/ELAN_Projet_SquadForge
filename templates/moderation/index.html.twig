{% extends 'base.html.twig' %}

{% block title %}Profil utilisateur{% endblock %}

{% block body %}

    
    <header class="globalBanner" style="background: url('{{ asset('img/banner.jpg') }}' )">
        <a href="{{ path('app_home') }}"><img src="{{ asset('img/logoSquadForge_White_Rogned.png') }}" class="logoPng" /></a>
        <nav>
            <a href="{{ path('app_games') }}">JEUX</a>
            {% if app.user %}
                <a href="{{ path('app_userGroups') }}">TEAMS</a>
            {% endif %}
            {% if app.user and "ROLE_MODO" in app.user.roles %}
                <a href="{{ path('app_moderationDashboard') }}">Modération</a>
            {% endif %}
        </nav>
    </header>
    <div class="headerUnderline"></div>

    <div class="main">

        <h2>Espace Modération</h2>

        <h3>Mots censurés</h3>
        
        <div style="display:inline-flex; flex-direction:column; width:80%;">
            {% for censureWord in censureWords %}
                <div style="display:inline-flex; justify-content:space-evenly;">
                    <p>"{{ censureWord.word }}"</p>
                    <p>{{ time_diff(censureWord.creationDate) }}</p>
                    <p>par {{ censureWord.user.pseudo }}</p>
                    <a href="{{ path('app_deleteCensure', {'id': censureWord.id }) }}">
                        <i class="fa-solid fa-xmark"></i>
                    </a>
                </div>
            {% endfor %}

            {{ form_start(formAddCensoredWord) }}
                <div class="inline" style="position:relative; margin: 5px auto;">
                    {{ form_widget(formAddCensoredWord.word) }} 
                    {{ form_widget(formAddCensoredWord.submit) }}
                </div>
            {{ form_end(formAddCensoredWord) }}
        </div>


        {# Dans l'idée: OnClick: Affiche titre en entier et pour Topic affiche le 1st msg aussi (anim clip-path css ?) #}

        <h3>Topics en attente de validation</h3>

        {% if lastWaitingTopics|length == 0 %}

            <p class="emptyListMsg">Aucun topic en attente de validation</p>
            
        {% else %}
                    
            {% for topic in lastWaitingTopics %}

                {# <a href="{{ path('app_topicDetail', {'id': topic.id}) }}"> #}
                    <div id="topicCard{{ topic.id }}" class="topicCard" style="border-bottom: 4px solid {{ topic.game.color }}; cursor:pointer;">
                        <img class="tinyLogo" src="{{ asset('img/games/tinyLogo/' ~ topic.game.tinyLogo) }}" />
                        <span id="topicTitle{{ topic.id }}" class="topicTitle">{{ topic.title|capitalize }}</span>
                        <span>{{ topic.validated }}</span>
                        <span>{{ topic.user.pseudo }}</span>
                        <span class="topicCardPublishDate">{{ time_diff(topic.publishDate) }}</span>
                        {% if topic.topicPostsCount == 0 %}
                            <span style="opacity:0.5;">{{ topic.topicPostsCount }} <i class="fa-solid fa-message" style="color:grey;"></i></span>
                        {% else %}
                            <span>{{ topic.topicPostsCount }} <i class="fa-solid fa-message" style="color:{{ topic.game.color }}"></i></span>
                        {% endif %}
                    </div>
                    <div id="topicSubCard{{ topic.id }}" class="topicSubCard notDisplayed">
                        <p>{{ topic.firstMsg }}</p>
                        <div class="mediaApprovalLine">
                            <a href="{{ path('app_validateTopic', {'id': topic.id}) }}">
                                <span class="mediaApproveBtn"><i class="fa-solid fa-check"></i></span>
                            </a>
                            <a href="{{ path('app_refuseTopic', {'id': topic.id}) }}">
                                <span class="mediaRefuseBtn"><i class="fa-solid fa-xmark"></i></span>
                            </a>
                        </div>

                    </div>
                {# </a> #}

                {# OnClick TopicCard: détails et boutons validation/refus #}
                <script>
                    document.getElementById('topicCard{{ topic.id }}').addEventListener('click', function() {
                        document.getElementById('topicSubCard{{ topic.id }}').classList.toggle('notDisplayed');
                    });
                </script>

            {% endfor %}

        {% endif %} 



        <h3>Médias en attente de validation</h3>


        {% if lastWaitingMedias|length == 0 %}

            <p class="emptyListMsg">Aucun média en attente de validation</p>

        {% else %}

            <div class="listContainer marginTop mediaList">

                    {% for media in lastWaitingMedias %}

                        <div id="mediaCard{{ media.id }}" class="mediaCard" style="cursor:pointer;">
                            <div class="mediaCardHeader" style="border-bottom: 4px solid {{ media.game.color }}">
                                <img class="tinyLogo" src="{{ asset('img/games/tinyLogo/' ~ media.game.tinyLogo) }}" />
                                <span id="mediaCardTitle{{ media.id }}" class="mediaTitle" style="font-family:'K2D',sans-serif;">{{ media.title|capitalize }}</span>
                                <span id="topicStatusValidate{{ media.id }}">{{ media.validated }}</span>
                                {# <span>{{ media.user.pseudo }}</span> #}
                                <span class="topicCardPublishDate">{{ time_diff(media.publishDate) }}</span>
                            </div>
                            <img src="{{ asset("img/uploads/" ~ media.url) }}" alt="media" class="mediaImg" />
                        </div>

                        <div id="mediaSubCard{{ media.id }}" class="mediaApprovalLine notDisplayed">
                            <a href="{{ path('app_validateMedia', {'id': media.id}) }}">
                                <span class="mediaApproveBtn"><i class="fa-solid fa-check"></i></span>
                            </a>
                            <a href="{{ path('app_refuseMedia', {'id': media.id}) }}">
                                <span class="mediaRefuseBtn"><i class="fa-solid fa-xmark"></i></span>
                            </a>
                        </div>

                        {# OnClick MediaCard: détails et boutons validation/refus #}
                        <script>
                            document.getElementById('mediaCard{{ media.id }}').addEventListener('click', function() {
                                document.getElementById('mediaSubCard{{ media.id }}').classList.toggle('notDisplayed');
                                document.getElementById('mediaCard{{ media.id }}').classList.toggle('mediaCard');
                                document.getElementById('mediaCardTitle{{ media.id }}').classList.toggle('mediaTitle');
                                document.getElementById('topicStatusValidate{{ media.id }}').classList.toggle('mediaStatusValidate');
                            });
                        </script>

                    {% endfor %}

            </div>

        {% endif %}




        

        








    </div>

{% endblock %}
